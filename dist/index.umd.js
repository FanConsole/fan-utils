(function(a,g){typeof exports=="object"&&typeof module<"u"?g(exports,require("clipboard"),require("gcoord")):typeof define=="function"&&define.amd?define(["exports","clipboard","gcoord"],g):(a=typeof globalThis<"u"?globalThis:a||self,g(a.FanUtils={},a.ClipboardJS,a.gcoord))})(this,function(a,g,h){"use strict";const y=(e,...t)=>{console.warn("FanUtils:",e,...t)},l=typeof window<"u";function S(e){return e instanceof Promise||typeof(e==null?void 0:e.then)=="function"}const C=e=>/^1[3-9]{1}\d{9}$/.test(e);function N(e){const t=[];let n=!1;return(...o)=>new Promise(async(r,i)=>{if(t.push({resolve:r,reject:i}),!n){n=!0;try{const c=await e(...o);t.forEach(u=>u.resolve(c))}catch(c){t.forEach(u=>u.reject(c))}t.length=0,n=!1}})}function p(e){return""+((e==null?void 0:e.prefix)||"")+Math.floor(Math.random()*1e6).toString(36)}const P=(e,t=!1)=>{const n=e.replace(/-(\w)/g,(o,r)=>r.toUpperCase());return t?`${n[0].toUpperCase()}${n.substring(1)}`:n},T=e=>e.replace(/[A-Z]/g,t=>"-"+t.toLowerCase());function v(e,t=150){let n=0;return function(...o){const r=Date.now();r-n>t&&(e.apply(this,o),n=r)}}function I(e,t=200,n=!1){let o;return function(...r){if(o&&clearTimeout(o),n)return o=null,e.apply(this,r);o=setTimeout(()=>e.apply(this,r),t)}}function b(e,t=1){if(t<0)return e;const n=decodeURIComponent(e);if(t===0&&n.includes("%"))return b(n,0);const o=t-1;return o<=0?n:b(n,o)}const D=(e=0)=>new Promise(t=>{setTimeout(()=>t(!0),e)}),M=()=>{if(!l)return{};const e=navigator.userAgent,t=/macintosh|mac os x/i.test(e),n=/micromessenger/.test(e.toLowerCase());return{devicePixelRatio:window.devicePixelRatio,language:navigator.language,windowHeight:window.innerHeight,windowWidth:window.innerWidth,statusBarHeight:0,navBarHeight:0,isMac:t,isIos:/(iPhone|iPad|iPod|iOS)/i.test(e)||t,isWeixin:n,isAlipay:/alipay/.test(e.toLowerCase()),isMpWebWeixin:n&&e.includes("miniProgram")}},E=e=>(l&&(window.location.href="tel:"+e),new Promise(t=>t(e))),W=e=>{!e||!l||(document.title=e)},$=e=>{},H=async e=>{if(l){var t=document.createElement("a");t.href=e,t.target="_blank",t.download=`${p()}`,document.body.appendChild(t),t.click(),document.body.removeChild(t)}},Y=()=>l?location.href:"",k=()=>new Promise(e=>{if(!window.my||!window.my.getEnv)return e(!1);const t=setTimeout(()=>{e(!1)},2e3);window.my.getEnv(n=>{clearTimeout(t),e(n.miniprogram)})}),A=(e,t)=>new Promise((n,o)=>{const r=document.createElement("script");if(t)for(let i in t)r.setAttribute(i,t[i]);r.src=e,r.onload=n,r.onerror=i=>{document.head.removeChild(r),o(i)},document.head.appendChild(r)}),L=e=>new Promise((t,n)=>{if(!l){t({text:e});return}const o=document.createElement("button"),r=new g(o,{text:()=>e||"",action:()=>"copy",container:document.body});r.on("success",i=>{r.destroy(),t(i)}),r.on("error",()=>{r.destroy(),n(new Error(g.isSupported()?"复制失败，请手动复制":"浏览器不支持一键复制，请手动复制"))}),document.body.appendChild(o),o.click(),document.body.removeChild(o)}),f=(e,t=2,n)=>{const o=Number(e);if(isNaN(o))return 0;const{floor:r}=n||{},i=Math.pow(10,t+1),c=Math.pow(10,t);return(r?Math.floor(o*i/10):Math.round(o*i/10))/c},w=(e,t=2,n)=>{const{right:o,sign:r="0"}=n||{},i=String(e);let c="";const u=t-i.length;if(u>0)for(let s=0;s<u;s++)c+=r;return o?`${i}${c}`:`${c}${i}`},B=(e,t)=>{const{lang:n="zh",plusSign:o=!1,decimal:r,floor:i=!0}=t||{},c=n==="zh"?1e4:1e3,u=typeof r=="number"?r:n==="zh"?2:1;if(e<c){if(o){if(e>1e3)return`${Math.floor(e/1e3)*1e3}+`;if(e>100)return`${Math.floor(e/100)*100}+`}return f(e,u,{floor:i})+""}let s;if(n==="zh"){const d=["","万","亿","万亿"],m=Math.floor(Math.log(e)/Math.log(c));s=f(e/Math.pow(c,m),u,{floor:i})+d[m]}else e>=1e6?s=f(e/1e6,u,{floor:i})+"m":e>=1e4?s=f(e/1e4,u,{floor:i})+"w":s=f(e/1e3,u,{floor:i})+"k";return`${s}${o?"+":""}`},U=e=>Number(e).toLocaleString(),z=(e,t,n)=>{if(!e||!l)return;const{expired:o=0,runTime:r}=n||{},i=JSON.stringify({t:Date.now(),expired:o,data:t});r?sessionStorage.setItem(e,i):localStorage.setItem(e,i)},G=(e,t)=>{if(!e||!l)return null;const{runTime:n,expired:o}=t||{};let r=n?sessionStorage.getItem(e):localStorage.getItem(e);if(!r)return r;try{r=JSON.parse(r)}catch(c){return y("Error getStorage parse..",c),r}const i=o||r.expired;return i&&r.t&&Date.now()-r.t>i?null:r.data},R=(e,t)=>{if(!l)return;const{runTime:n}=t||{};n?sessionStorage.removeItem(e):localStorage.removeItem(e)},F=e=>{if(!l)return;const{runTime:t}={...e};t?sessionStorage.clear():localStorage.clear()},J=e=>(e.length>19&&(e=e.substring(0,19).replace("T"," ")),new Date(e.replace(/-/g,"/"))),j=(e,t)=>{const{format:n="YYYY-MM-DD HH:mm:ss"}=t||{},o=e.getFullYear(),r=w(e.getMonth()+1,2),i=w(e.getDate(),2),c=w(e.getHours(),2),u=w(e.getMinutes(),2),s=w(e.getSeconds(),2);return n.replace("YYYY",`${o}`).replace("MM",r).replace("DD",i).replace("HH",c).replace("mm",u).replace("ss",s)},q=(e,t,n,o)=>{if(e=Number(e),t=Number(t),n=Number(n),o=Number(o),e===n&&t===o)return 0;{const r=Math.PI*e/180,i=Math.PI*n/180,c=t-o,u=Math.PI*c/180;let s=Math.sin(r)*Math.sin(i)+Math.cos(r)*Math.cos(i)*Math.cos(u);return s>1&&(s=1),s=Math.acos(s),s=s*180/Math.PI,s=s*60*1.1515*1609.34,Math.round(s)}},O=e=>{const{type:t="gcj02",timeout:n}=e||{};return new Promise((o,r)=>{if(!l)return o({accuracy:0,latitude:0,longitude:0});if(!navigator.geolocation){r(new Error("该浏览器不支持获取地理位置"));return}navigator.geolocation.getCurrentPosition(i=>{const{accuracy:c,latitude:u,longitude:s}=i.coords;if(t==="gcj02"){const[d,m]=h.transform([s,u],h.WGS84,h.GCJ02);o({accuracy:c,latitude:Number(m),longitude:Number(d)});return}o({accuracy:c,latitude:Number(u),longitude:Number(s)})},i=>r(i),{enableHighAccuracy:!0,timeout:n,maximumAge:1e3*60})})},_=e=>{const{type:t="gcj02",timeout:n,weixinReady:o}=e||{};return new Promise((r,i)=>{var s;if(!l)return r({accuracy:0,latitude:0,longitude:0});let c;(o||((s=window.fanWeixinSdk)==null?void 0:s.onConfigReady)||window.wx.ready)(()=>{n&&(c=setTimeout(()=>i(new Error("微信位置获取超时")),n)),window.wx.getLocation({type:t,success:d=>{c&&clearTimeout(c),r({latitude:Number(d.latitude),longitude:Number(d.longitude),accuracy:d.accuracy})},fail:d=>{c&&clearTimeout(c),i(new Error(d.errMsg))},cancel:()=>{c&&clearTimeout(c),i(new Error("用户取消了微信位置授权"))}})})})},Z=async e=>{if(!l)return{accuracy:0,latitude:0,longitude:0,from:"browser"};const{type:t="gcj02",useWeixin:n=!0,timeout:o,weixinTimeout:r,weixinReady:i}=e||{},{isWeixin:c}=M();let u="";if(c&&n&&!!window.wx)try{return{...await _({type:t,timeout:r||o,weixinReady:i}),from:"weixin"}}catch(m){u+=`[wx]${m.message}`}return{...await O({type:t,timeout:o}),from:"browser",errMsg:u}};a.camelize=P,a.clearStorage=F,a.createUniqueId=p,a.dateFromString=J,a.debounce=I,a.decodeString=b,a.formatDate=j,a.getCoordinatesDistance=q,a.getCurrentUrl=Y,a.getGeolocation=Z,a.getStorage=G,a.getSystemInfo=M,a.inBrowser=l,a.isMpWebAlipay=k,a.isPromiseLike=S,a.kebabCase=T,a.libLogWarn=y,a.loadJs=A,a.makingCall=E,a.mergeConcurrent=N,a.padNumber=w,a.partNumber=U,a.removeStorage=R,a.roundNumber=f,a.saveImage=H,a.setClipboard=L,a.setNavigationBarColor=$,a.setPageTitle=W,a.setStorage=z,a.sleep=D,a.throttle=v,a.unitNumber=B,a.validatePhoneNumber=C,Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})});
