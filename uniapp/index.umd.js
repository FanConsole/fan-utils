(function(i,f){typeof exports=="object"&&typeof module<"u"?f(exports):typeof define=="function"&&define.amd?define(["exports"],f):(i=typeof globalThis<"u"?globalThis:i||self,f(i.FanUtils={}))})(this,function(i){"use strict";const f=(e,...t)=>{console.warn("FanUtils:",e,...t)},B=typeof window<"u";function I(e){return e instanceof Promise||typeof(e==null?void 0:e.then)=="function"}const T=e=>/^1[3-9]{1}\d{9}$/.test(e);function v(e){const t=[];let n=!1;return(...r)=>new Promise(async(o,s)=>{if(t.push({resolve:o,reject:s}),!n){n=!0;try{const a=await e(...r);t.forEach(c=>c.resolve(a))}catch(a){t.forEach(c=>c.reject(a))}t.length=0,n=!1}})}function D(e){return""+((e==null?void 0:e.prefix)||"")+Math.floor(Math.random()*1e6).toString(36)}const L=(e,t=!1)=>{const n=e.replace(/-(\w)/g,(r,o)=>o.toUpperCase());return t?`${n[0].toUpperCase()}${n.substring(1)}`:n},W=e=>e.replace(/[A-Z]/g,t=>"-"+t.toLowerCase());function $(e,t=150){let n=0;return function(...r){const o=Date.now();o-n>t&&(e.apply(this,r),n=o)}}function A(e,t=200,n=!1){let r;return function(...o){if(r&&clearTimeout(r),n)return r=null,e.apply(this,o);r=setTimeout(()=>e.apply(this,o),t)}}function b(e,t=1){if(t<0)return e;const n=decodeURIComponent(e);if(t===0&&n.includes("%"))return b(n,0);const r=t-1;return r<=0?n:b(n,r)}const Y=(e=0)=>new Promise(t=>{setTimeout(()=>t(!0),e)});let y;const U=()=>{if(y)return y;let e=!0;const t=uni.getDeviceInfo?{...uni.getDeviceInfo(),...uni.getWindowInfo(),...uni.getAppBaseInfo()}:uni.getSystemInfoSync();let n=t.platform.toLowerCase().includes("mac");const r=t.system?t.system.toLowerCase().includes("ios"):n;let o=!0,s=!1,a=!1,c=!1,u=!1,d=!1,g=!1;//! // #ifdef MP-ALIPAY
o=!1,s=!0,d=!0;//! // #endif
//! // #ifdef MP-WEIXIN
u=!0;//! // #endif
//! // #ifdef MP
c=!0;//! // #endif
//! // #ifdef APP-PLUS
a=!0;//! // #endif
//! // #ifdef H5
const p=navigator.userAgent;n=/macintosh|mac os x/i.test(p),o=/micromessenger/.test(p.toLowerCase()),s=/alipay/.test(p.toLowerCase()),g=o&&p.includes("miniProgram");//! // #endif
let l=uni.getMenuButtonBoundingClientRect&&uni.getMenuButtonBoundingClientRect();if(!l||!l.left||!l.top||!l.width||!l.height){e=!1;let M=0,C=96;t.platform==="devtools"?M=r?5.5:7.5:(M=r?4:8,C=r?88:96),t.statusBarHeight||(t.statusBarHeight=t.screenHeight-t.windowHeight-20),l={width:C,height:32,bottom:t.statusBarHeight+M+32,left:t.windowWidth-C-10,right:t.windowWidth-10,top:t.statusBarHeight+M}}let S=44;t.statusBarHeight?S=t.statusBarHeight+(l.top-t.statusBarHeight)*2+l.height:(e=!1,S=(l.top-(t.screenHeight-t.windowHeight-20))*2+l.height,t.statusBarHeight=0);const H={devicePixelRatio:t.pixelRatio,language:t.language||"",windowWidth:t.windowWidth,windowHeight:t.windowHeight,statusBarHeight:t.statusBarHeight,navBarHeight:S,mpMenuButtonRect:l,isIos:r,isMac:n,isWeixin:o,isAlipay:s,isApp:a,isMp:c,isMpWeixin:u,isMpAlipay:d,isMpWebWeixin:g};return e&&(y=H),H},E=e=>uni.makePhoneCall({phoneNumber:e}),z=e=>{e&&uni.setNavigationBarTitle({title:e})},R=e=>{const{frontColor:t="",backgroundColor:n=""}=e;uni.setNavigationBarColor({frontColor:t.toLowerCase(),backgroundColor:n.toLowerCase()})},k=e=>new Promise((t,n)=>{uni.getImageInfo({src:e,success:r=>t(r.path),fail:r=>n(new Error(r.errMsg||r.errorMessage))})}),F=e=>new Promise((t,n)=>{uni.saveImageToPhotosAlbum({filePath:e,success:r=>t(r),fail:r=>{const o=r.errMsg||r.errorMessage||"";(o.includes("deny")||o.includes("denied"))&&uni.showModal({title:"温馨提示",content:"请开启相册权限后再操作",confirmText:"去开启",success:s=>{s.confirm&&uni.openSetting()}}),n(new Error(o))}})}),j=async e=>{e.startsWith("http://tmp/")||(e=await k(e)),await F(e)};function J(){const e=getCurrentPages();return e[e.length-1].$page.fullPath}function G(){return new Promise(e=>e(!1))}const O=()=>new Promise((e,t)=>t("不支持")),q=e=>new Promise((t,n)=>{uni.setClipboardData({data:e||"",success:()=>t({text:e}),fail:r=>{n(new Error(r.errMsg||r.errorMessage||"复制失败，请手动复制"))}})}),h=(e,t=2,n)=>{const r=Number(e);if(isNaN(r))return 0;const{floor:o}=n||{},s=Math.pow(10,t+1),a=Math.pow(10,t);return(o?Math.floor(r*s/10):Math.round(r*s/10))/a},m=(e,t=2,n)=>{const{right:r,sign:o="0"}=n||{},s=String(e);let a="";const c=t-s.length;if(c>0)for(let u=0;u<c;u++)a+=o;return r?`${s}${a}`:`${a}${s}`},_=(e,t)=>{const{lang:n="zh",plusSign:r=!1,decimal:o,floor:s=!0}=t||{},a=n==="zh"?1e4:1e3,c=typeof o=="number"?o:n==="zh"?2:1;if(e<a){if(r){if(e>1e3)return`${Math.floor(e/1e3)*1e3}+`;if(e>100)return`${Math.floor(e/100)*100}+`}return h(e,c,{floor:s})+""}let u;if(n==="zh"){const d=["","万","亿","万亿"],g=Math.floor(Math.log(e)/Math.log(a));u=h(e/Math.pow(a,g),c,{floor:s})+d[g]}else e>=1e6?u=h(e/1e6,c,{floor:s})+"m":e>=1e4?u=h(e/1e4,c,{floor:s})+"w":u=h(e/1e3,c,{floor:s})+"k";return`${u}${r?"+":""}`},K=e=>Number(e).toLocaleString(),w=new Map,P=(e,t,n)=>{if(!e)return;const{expired:r=0,runTime:o}=n||{},s={t:Date.now(),expired:r,data:t};o?w.set(e,s):uni.setStorageSync(e,JSON.stringify(s))},N=(e,t)=>{if(!e)return null;const{runTime:n,expired:r}=t||{};let o=n?w.get(e):uni.getStorageSync(e);if(!o)return o;if(!n)try{o=JSON.parse(o)}catch(a){return f("Error getStorage parse..",a),o}const s=r||o.expired;return s&&o.t&&Date.now()-o.t>s?null:o.data},Z=(e,t)=>{const{runTime:n}=t||{};n?w.delete(e):uni.removeStorageSync(e)},Q=e=>{const{runTime:t}=e||{};t?w.clear():uni.clearStorageSync()},V=e=>(e.length>19&&(e=e.substring(0,19).replace("T"," ")),new Date(e.replace(/-/g,"/"))),X=(e,t)=>{const{format:n="YYYY-MM-DD HH:mm:ss"}=t||{},r=e.getFullYear(),o=m(e.getMonth()+1,2),s=m(e.getDate(),2),a=m(e.getHours(),2),c=m(e.getMinutes(),2),u=m(e.getSeconds(),2);return n.replace("YYYY",`${r}`).replace("MM",o).replace("DD",s).replace("HH",a).replace("mm",c).replace("ss",u)},x=(e,t,n,r)=>{if(e=Number(e),t=Number(t),n=Number(n),r=Number(r),e===n&&t===r)return 0;{const o=Math.PI*e/180,s=Math.PI*n/180,a=t-r,c=Math.PI*a/180;let u=Math.sin(o)*Math.sin(s)+Math.cos(o)*Math.cos(s)*Math.cos(c);return u>1&&(u=1),u=Math.acos(u),u=u*180/Math.PI,u=u*60*1.1515*1609.34,Math.round(u)}},ee=e=>{const{type:t="gcj02",timeout:n}=e||{};return new Promise((r,o)=>{const s="fanLastGeolocation",a=N(s,{runTime:!0});if(a){r(a);return}uni.getLocation({type:t,highAccuracyExpireTime:n,success:({latitude:c,longitude:u,accuracy:d})=>{const g={accuracy:d,latitude:Number(c),longitude:Number(u)};P(s,g,{runTime:!0,expired:3e4}),r(g)},fail:c=>o(new Error(c.errMsg||c.errorMessage))})})};i.camelize=L,i.clearStorage=Q,i.createUniqueId=D,i.dateFromString=V,i.debounce=A,i.decodeString=b,i.formatDate=X,i.getCoordinatesDistance=x,i.getCurrentUrl=J,i.getGeolocation=ee,i.getStorage=N,i.getSystemInfo=U,i.inBrowser=B,i.isMpWebAlipay=G,i.isPromiseLike=I,i.kebabCase=W,i.libLogWarn=f,i.loadJs=O,i.makingCall=E,i.mergeConcurrent=v,i.padNumber=m,i.partNumber=K,i.removeStorage=Z,i.roundNumber=h,i.saveImage=j,i.setClipboard=q,i.setNavigationBarColor=R,i.setPageTitle=z,i.setStorage=P,i.sleep=Y,i.throttle=$,i.unitNumber=_,i.validatePhoneNumber=T,Object.defineProperty(i,Symbol.toStringTag,{value:"Module"})});
